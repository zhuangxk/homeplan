"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = getApp();
var index_1 = require("../../../api/index");
var util_1 = require("../../../utils/util");
Component({
    data: {
        show: false,
        CustomBar: app.globalData.CustomBar,
        bills: [],
        dateMap: {},
        monthMap: {},
        dateMapKeys: [],
        loading: false,
        total: 0,
        params: {
            "page": 1,
            "page_size": -1
        },
        localsNum: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
    },
    properties: {
        ledgerId: {
            type: Number
        }
    },
    lifetimes: {
        ready: function () {
            this.getBills();
        }
    },
    observers: {
        ledgerId: function () {
            this.getBills();
        }
    },
    methods: {
        getBills: function () {
            var _this = this;
            if (!this.data.ledgerId) {
                return;
            }
            if (this.data.loading) {
                return;
            }
            this.data.loading = true;
            wx.showLoading({
                title: '加载中'
            });
            index_1.getBills(this.data.ledgerId, this.data.params).then(function (res) {
                _this.handleBillsRes(res);
                wx.hideLoading();
                _this.data.loading = false;
            });
        },
        handleBillsRes: function (res) {
            var _this = this;
            var list = res.list;
            var date_count = res.date_count;
            var month_count = res.month_count;
            var dateMap = {};
            date_count.forEach(function (item) {
                dateMap[_this.getDateKey(item.date)] = {
                    list: [],
                    total: item.total,
                    sum_in: item.sum_in,
                    sum_out: item.sum_out,
                };
            });
            list.forEach(function (item) {
                var date = dateMap[_this.getDateKey(item.bill_time)];
                if (date.list) {
                    date.list.push(item);
                }
                else {
                    wx.showToast({
                        title: "计数出错"
                    });
                }
            });
            this.setData({
                total: res.total,
                dateMap: dateMap,
                dateMapKeys: Object.keys(dateMap),
                monthMap: month_count[0],
            });
        },
        getDateKey: function (iosdate) {
            var date = new Date(iosdate);
            var dateKey = util_1.formatMonthDate(date) + "  星期" + this.data.localsNum[date.getDay() - 1];
            if (util_1.formatMonthDate(date) == util_1.formatMonthDate(new Date())) {
                dateKey = "今日  星期" + this.data.localsNum[new Date().getDay() - 1];
            }
            return dateKey;
        },
        onAdd: function () {
            this.setData({
                show: true
            });
        },
        onClose: function () {
            this.setData({
                show: false
            });
        },
        onSave: function () {
            this.setData({
                show: false
            });
            this.getBills();
        },
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJpbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLEdBQUcsR0FBRyxNQUFNLEVBQWdCLENBQUE7QUFDbEMsNENBQTZDO0FBQzdDLDRDQUFxRDtBQUNyRCxTQUFTLENBQUM7SUFDTixJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFNBQVM7UUFDbkMsS0FBSyxFQUFFLEVBQWM7UUFDckIsT0FBTyxFQUFFLEVBQStCO1FBQ3hDLFFBQVEsRUFBRSxFQUErQjtRQUN6QyxXQUFXLEVBQUUsRUFBbUI7UUFDaEMsT0FBTyxFQUFFLEtBQUs7UUFDZCxLQUFLLEVBQUUsQ0FBQztRQUNSLE1BQU0sRUFBRTtZQUNKLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsQ0FBQztTQUNsQjtRQUNELFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxJQUFJLEVBQUMsSUFBSSxDQUFDO0tBQ2pFO0lBQ0QsVUFBVSxFQUFFO1FBQ1IsUUFBUSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07U0FDZjtLQUNKO0lBQ0QsU0FBUyxFQUFFO1FBQ1AsS0FBSyxFQUFMO1lBQ0UsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2pCLENBQUM7S0FDSjtJQUNELFNBQVMsRUFBRTtRQUNQLFFBQVEsRUFBUjtZQUNJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNuQixDQUFDO0tBQ0o7SUFDRCxPQUFPLEVBQUU7UUFDTCxRQUFRLEVBQVI7WUFBQSxpQkFnQkM7WUFmRyxJQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUM7Z0JBQ25CLE9BQU07YUFD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LE9BQU8sQ0FBQztnQkFDVCxJQUFJLEVBQUUsSUFBSTthQUNiLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFFRCxPQUFPLEVBQVA7WUFDSSxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULElBQUksRUFBRSxLQUFLO2FBQ2QsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUVELE1BQU0sRUFBTjtZQUNJLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLEtBQUs7YUFDZCxDQUFDLENBQUE7WUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDbkIsQ0FBQztLQUNKO0NBRUosQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgYXBwID0gZ2V0QXBwKCkgYXMgSUFwcE9wdGlvblxyXG5pbXBvcnQgeyBnZXRCaWxscyB9IGZyb20gXCIuLi8uLi8uLi9hcGkvaW5kZXhcIlxyXG5pbXBvcnQgeyBmb3JtYXRNb250aERhdGUgfSBmcm9tIFwiLi4vLi4vLi4vdXRpbHMvdXRpbFwiXHJcbkNvbXBvbmVudCh7XHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgc2hvdzogZmFsc2UsXHJcbiAgICAgICAgQ3VzdG9tQmFyOiBhcHAuZ2xvYmFsRGF0YS5DdXN0b21CYXIsXHJcbiAgICAgICAgYmlsbHM6IFtdIGFzIEFueUFycmF5LFxyXG4gICAgICAgIGRhdGVNYXA6IHt9IGFzIFJlY29yZDxzdHJpbmcsIEFueU9iamVjdD4sXHJcbiAgICAgICAgbW9udGhNYXA6IHt9IGFzIFJlY29yZDxzdHJpbmcsIEFueU9iamVjdD4sXHJcbiAgICAgICAgZGF0ZU1hcEtleXM6IFtdIGFzIEFycmF5PHN0cmluZz4sXHJcbiAgICAgICAgbG9hZGluZzogZmFsc2UsXHJcbiAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgcGFyYW1zOiB7XHJcbiAgICAgICAgICAgIFwicGFnZVwiOiAxLFxyXG4gICAgICAgICAgICBcInBhZ2Vfc2l6ZVwiOiAtMVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbG9jYWxzTnVtOiBbXCLkuIBcIixcIuS6jFwiLFwi5LiJXCIsXCLlm5tcIixcIuS6lFwiLFwi5YWtXCIsXCLkuINcIixcIuWFq1wiLFwi5LmdXCIsXCLljYFcIixcIuWNgeS4gFwiLFwi5Y2B5LqMXCJdLFxyXG4gICAgfSxcclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBsZWRnZXJJZDogeyBcclxuICAgICAgICAgICAgdHlwZTogTnVtYmVyXHJcbiAgICAgICAgfSAgXHJcbiAgICB9LFxyXG4gICAgbGlmZXRpbWVzOiB7XHJcbiAgICAgICAgcmVhZHkoKTogdm9pZHtcclxuICAgICAgICAgIHRoaXMuZ2V0QmlsbHMoKSAgXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG9ic2VydmVyczoge1xyXG4gICAgICAgIGxlZGdlcklkKCk6IHZvaWQge1xyXG4gICAgICAgICAgICB0aGlzLmdldEJpbGxzKCkgXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIG1ldGhvZHM6IHtcclxuICAgICAgICBnZXRCaWxscygpOiB2b2lke1xyXG4gICAgICAgICAgICBpZighdGhpcy5kYXRhLmxlZGdlcklkKXtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKHRoaXMuZGF0YS5sb2FkaW5nKXtcclxuICAgICAgICAgICAgICAgIHJldHVyblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZGF0YS5sb2FkaW5nID0gdHJ1ZVxyXG4gICAgICAgICAgICB3eC5zaG93TG9hZGluZyh7XHJcbiAgICAgICAgICAgICAgICB0aXRsZTogJ+WKoOi9veS4rSdcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgZ2V0QmlsbHModGhpcy5kYXRhLmxlZGdlcklkLCB0aGlzLmRhdGEucGFyYW1zKS50aGVuKHJlcz0+e1xyXG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVCaWxsc1JlcyhyZXMpXHJcbiAgICAgICAgICAgICAgICB3eC5oaWRlTG9hZGluZygpXHJcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEubG9hZGluZyA9IGZhbHNlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICAgICAgICBoYW5kbGVCaWxsc1JlcyhyZXM6IEFueU9iamVjdCk6IHZvaWR7XHJcbiAgICAgICAgICAgIGNvbnN0IGxpc3QgPSByZXMubGlzdCBhcyBBbnlBcnJheVxyXG4gICAgICAgICAgICBjb25zdCBkYXRlX2NvdW50ID0gcmVzLmRhdGVfY291bnQgYXMgQW55QXJyYXlcclxuICAgICAgICAgICAgY29uc3QgbW9udGhfY291bnQgPSByZXMubW9udGhfY291bnQgYXMgQW55QXJyYXlcclxuICAgICAgICAgICAgY29uc3QgZGF0ZU1hcCA9IHt9IGFzIFJlY29yZDxzdHJpbmcsIEFueU9iamVjdD5cclxuICAgICAgICAgICAgZGF0ZV9jb3VudC5mb3JFYWNoKGl0ZW09PntcclxuICAgICAgICAgICAgICAgIGRhdGVNYXBbdGhpcy5nZXREYXRlS2V5KGl0ZW0uZGF0ZSldID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6W10sXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IGl0ZW0udG90YWwsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VtX2luOiBpdGVtLnN1bV9pbixcclxuICAgICAgICAgICAgICAgICAgICBzdW1fb3V0OiBpdGVtLnN1bV9vdXQsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsaXN0LmZvckVhY2goIGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGRhdGVNYXBbdGhpcy5nZXREYXRlS2V5KGl0ZW0uYmlsbF90aW1lKV1cclxuICAgICAgICAgICAgICAgIGlmKGRhdGUubGlzdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZS5saXN0LnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwi6K6h5pWw5Ye66ZSZXCJcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgdG90YWw6IHJlcy50b3RhbCxcclxuICAgICAgICAgICAgICAgIGRhdGVNYXAsXHJcbiAgICAgICAgICAgICAgICBkYXRlTWFwS2V5czogT2JqZWN0LmtleXMoZGF0ZU1hcCksXHJcbiAgICAgICAgICAgICAgICBtb250aE1hcDogbW9udGhfY291bnRbMF0sXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICBcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldERhdGVLZXkoaW9zZGF0ZTpzdHJpbmcpOiBzdHJpbmd7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShpb3NkYXRlKVxyXG4gICAgICAgICAgICBsZXQgZGF0ZUtleSA9IGZvcm1hdE1vbnRoRGF0ZShkYXRlKSArIFwiICDmmJ/mnJ9cIiArIHRoaXMuZGF0YS5sb2NhbHNOdW1bZGF0ZS5nZXREYXkoKSAtIDFdXHJcbiAgICAgICAgICAgIGlmKGZvcm1hdE1vbnRoRGF0ZShkYXRlKSA9PSBmb3JtYXRNb250aERhdGUobmV3IERhdGUoKSkpe1xyXG4gICAgICAgICAgICAgICAgZGF0ZUtleSA9IFwi5LuK5pelICDmmJ/mnJ9cIiArIHRoaXMuZGF0YS5sb2NhbHNOdW1bbmV3IERhdGUoKS5nZXREYXkoKSAtIDFdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGVLZXlcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uQWRkKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBzaG93OiB0cnVlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICBcclxuICAgICAgICBvbkNsb3NlKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBzaG93OiBmYWxzZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG9uU2F2ZSgpOiB2b2lke1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2VcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5nZXRCaWxscygpXHJcbiAgICAgICAgfSxcclxuICAgIH1cclxuXHJcbn0pXHJcblxyXG5leHBvcnQgeyB9XHJcblxyXG4iXX0=