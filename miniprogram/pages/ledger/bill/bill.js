"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = getApp();
var index_1 = require("../../../api/index");
var util_1 = require("../../../utils/util");
Component({
    data: {
        show: false,
        CustomBar: app.globalData.CustomBar,
        bills: [],
        dateMap: {},
        loading: false,
        total: 0,
        params: {
            "page": 1,
            "page_size": -1
        },
        localsNum: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
    },
    properties: {
        ledgerId: {
            type: Number
        }
    },
    lifetimes: {
        ready: function () {
            this.getBills();
        }
    },
    observers: {
        ledgerId: function () {
            this.getBills();
        }
    },
    methods: {
        getBills: function () {
            var _this = this;
            if (!this.data.ledgerId) {
                return;
            }
            if (this.data.loading) {
                return;
            }
            this.data.loading = true;
            wx.showLoading({
                title: '加载中'
            });
            index_1.getBills(this.data.ledgerId, this.data.params).then(function (res) {
                _this.handleBillsRes(res);
                wx.hideLoading();
                _this.data.loading = false;
            });
        },
        handleBillsRes: function (res) {
            var _this = this;
            var list = res.list;
            var dateMap = {};
            list.forEach(function (item) {
                var date = new Date(item.bill_time);
                var dateKey = util_1.formatMonthDate(date) + "  星期" + _this.data.localsNum[date.getDay() - 1];
                dateMap[dateKey] = dateMap[dateKey] || {
                    list: [],
                    total: 0,
                    count: 0
                };
                dateMap[dateKey];
            });
            this.setData({
                bills: res.list,
                total: res.total,
                dateMap: dateMap
            });
            console.log(this.data.dateMap);
        },
        onAdd: function () {
            this.setData({
                show: true
            });
        },
        onClose: function () {
            this.setData({
                show: false
            });
        },
        onSave: function () {
            this.setData({
                show: false
            });
            this.getBills();
        },
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJpbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLEdBQUcsR0FBRyxNQUFNLEVBQWdCLENBQUE7QUFDbEMsNENBQTZDO0FBQzdDLDRDQUFxRDtBQUNyRCxTQUFTLENBQUM7SUFDTixJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFNBQVM7UUFDbkMsS0FBSyxFQUFFLEVBQWM7UUFDckIsT0FBTyxFQUFFLEVBQStCO1FBQ3hDLE9BQU8sRUFBRSxLQUFLO1FBQ2QsS0FBSyxFQUFFLENBQUM7UUFDUixNQUFNLEVBQUU7WUFDSixNQUFNLEVBQUUsQ0FBQztZQUNULFdBQVcsRUFBRSxDQUFDLENBQUM7U0FDbEI7UUFDRCxTQUFTLEVBQUUsQ0FBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsSUFBSSxFQUFDLElBQUksQ0FBQztLQUNqRTtJQUNELFVBQVUsRUFBRTtRQUNSLFFBQVEsRUFBRTtZQUNOLElBQUksRUFBRSxNQUFNO1NBQ2Y7S0FDSjtJQUNELFNBQVMsRUFBRTtRQUNQLEtBQUssRUFBTDtZQUNFLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNqQixDQUFDO0tBQ0o7SUFDRCxTQUFTLEVBQUU7UUFDUCxRQUFRLEVBQVI7WUFDSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDbkIsQ0FBQztLQUNKO0lBQ0QsT0FBTyxFQUFFO1FBQ0wsUUFBUSxFQUFSO1lBQUEsaUJBZ0JDO1lBZkcsSUFBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFDO2dCQUNuQixPQUFNO2FBQ1Q7WUFDRCxJQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFDO2dCQUNqQixPQUFNO2FBQ1Q7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUE7WUFDeEIsRUFBRSxDQUFDLFdBQVcsQ0FBQztnQkFDWCxLQUFLLEVBQUUsS0FBSzthQUNmLENBQUMsQ0FBQTtZQUNGLGdCQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxHQUFHO2dCQUNuRCxLQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFBO2dCQUN4QixFQUFFLENBQUMsV0FBVyxFQUFFLENBQUE7Z0JBQ2hCLEtBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQTtZQUM3QixDQUFDLENBQUMsQ0FBQTtRQUNOLENBQUM7UUFDRCxjQUFjLEVBQWQsVUFBZSxHQUFjO1lBQTdCLGlCQW1CQztZQWxCRyxJQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBZ0IsQ0FBQTtZQUNqQyxJQUFNLE9BQU8sR0FBRyxFQUErQixDQUFBO1lBQy9DLElBQUksQ0FBQyxPQUFPLENBQUUsVUFBQSxJQUFJO2dCQUNkLElBQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQTtnQkFDckMsSUFBTSxPQUFPLEdBQUcsc0JBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFBO2dCQUN2RixPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJO29CQUNuQyxJQUFJLEVBQUMsRUFBRTtvQkFDUCxLQUFLLEVBQUUsQ0FBQztvQkFDUixLQUFLLEVBQUUsQ0FBQztpQkFDWCxDQUFBO2dCQUNELE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQTtZQUNwQixDQUFDLENBQUMsQ0FBQTtZQUNGLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsS0FBSyxFQUFFLEdBQUcsQ0FBQyxJQUFJO2dCQUNmLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSztnQkFDaEIsT0FBTyxTQUFBO2FBQ1YsQ0FBQyxDQUFBO1lBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1FBQ2xDLENBQUM7UUFDRCxLQUFLLEVBQUw7WUFDSSxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULElBQUksRUFBRSxJQUFJO2FBQ2IsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUVELE9BQU8sRUFBUDtZQUNJLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLEtBQUs7YUFDZCxDQUFDLENBQUE7UUFDTixDQUFDO1FBRUQsTUFBTSxFQUFOO1lBQ0ksSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDVCxJQUFJLEVBQUUsS0FBSzthQUNkLENBQUMsQ0FBQTtZQUNGLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNuQixDQUFDO0tBQ0o7Q0FFSixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBhcHAgPSBnZXRBcHAoKSBhcyBJQXBwT3B0aW9uXHJcbmltcG9ydCB7IGdldEJpbGxzIH0gZnJvbSBcIi4uLy4uLy4uL2FwaS9pbmRleFwiXHJcbmltcG9ydCB7IGZvcm1hdE1vbnRoRGF0ZSB9IGZyb20gXCIuLi8uLi8uLi91dGlscy91dGlsXCJcclxuQ29tcG9uZW50KHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBzaG93OiBmYWxzZSxcclxuICAgICAgICBDdXN0b21CYXI6IGFwcC5nbG9iYWxEYXRhLkN1c3RvbUJhcixcclxuICAgICAgICBiaWxsczogW10gYXMgQW55QXJyYXksXHJcbiAgICAgICAgZGF0ZU1hcDoge30gYXMgUmVjb3JkPHN0cmluZywgQW55T2JqZWN0PixcclxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICB0b3RhbDogMCxcclxuICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgXCJwYWdlXCI6IDEsXHJcbiAgICAgICAgICAgIFwicGFnZV9zaXplXCI6IC0xXHJcbiAgICAgICAgfSxcclxuICAgICAgICBsb2NhbHNOdW06IFtcIuS4gFwiLFwi5LqMXCIsXCLkuIlcIixcIuWbm1wiLFwi5LqUXCIsXCLlha1cIixcIuS4g1wiLFwi5YWrXCIsXCLkuZ1cIixcIuWNgVwiLFwi5Y2B5LiAXCIsXCLljYHkuoxcIl0sXHJcbiAgICB9LFxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGxlZGdlcklkOiB7XHJcbiAgICAgICAgICAgIHR5cGU6IE51bWJlclxyXG4gICAgICAgIH0gIFxyXG4gICAgfSxcclxuICAgIGxpZmV0aW1lczoge1xyXG4gICAgICAgIHJlYWR5KCk6IHZvaWR7XHJcbiAgICAgICAgICB0aGlzLmdldEJpbGxzKCkgIFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBvYnNlcnZlcnM6IHtcclxuICAgICAgICBsZWRnZXJJZCgpOiB2b2lkIHtcclxuICAgICAgICAgICAgdGhpcy5nZXRCaWxscygpIFxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtZXRob2RzOiB7XHJcbiAgICAgICAgZ2V0QmlsbHMoKTogdm9pZHtcclxuICAgICAgICAgICAgaWYoIXRoaXMuZGF0YS5sZWRnZXJJZCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZih0aGlzLmRhdGEubG9hZGluZyl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmRhdGEubG9hZGluZyA9IHRydWVcclxuICAgICAgICAgICAgd3guc2hvd0xvYWRpbmcoe1xyXG4gICAgICAgICAgICAgICAgdGl0bGU6ICfliqDovb3kuK0nXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIGdldEJpbGxzKHRoaXMuZGF0YS5sZWRnZXJJZCwgdGhpcy5kYXRhLnBhcmFtcykudGhlbihyZXM9PntcclxuICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQmlsbHNSZXMocmVzKVxyXG4gICAgICAgICAgICAgICAgd3guaGlkZUxvYWRpbmcoKVxyXG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhLmxvYWRpbmcgPSBmYWxzZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGFuZGxlQmlsbHNSZXMocmVzOiBBbnlPYmplY3QpOiB2b2lke1xyXG4gICAgICAgICAgICBjb25zdCBsaXN0ID0gcmVzLmxpc3QgYXMgQW55QXJyYXlcclxuICAgICAgICAgICAgY29uc3QgZGF0ZU1hcCA9IHt9IGFzIFJlY29yZDxzdHJpbmcsIEFueU9iamVjdD5cclxuICAgICAgICAgICAgbGlzdC5mb3JFYWNoKCBpdGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShpdGVtLmJpbGxfdGltZSlcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVLZXkgPSBmb3JtYXRNb250aERhdGUoZGF0ZSkgKyBcIiAg5pif5pyfXCIgKyB0aGlzLmRhdGEubG9jYWxzTnVtW2RhdGUuZ2V0RGF5KCkgLSAxXVxyXG4gICAgICAgICAgICAgICAgZGF0ZU1hcFtkYXRlS2V5XSA9IGRhdGVNYXBbZGF0ZUtleV0gfHwge1xyXG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6W10sXHJcbiAgICAgICAgICAgICAgICAgICAgdG90YWw6IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgY291bnQ6IDBcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRhdGVNYXBbZGF0ZUtleV1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIGJpbGxzOiByZXMubGlzdCxcclxuICAgICAgICAgICAgICAgIHRvdGFsOiByZXMudG90YWwsXHJcbiAgICAgICAgICAgICAgICBkYXRlTWFwXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZGF0YS5kYXRlTWFwKVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgb25BZGQoKTogdm9pZHtcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIHNob3c6IHRydWVcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gIFxyXG4gICAgICAgIG9uQ2xvc2UoKTogdm9pZHtcclxuICAgICAgICAgICAgdGhpcy5zZXREYXRhKHtcclxuICAgICAgICAgICAgICAgIHNob3c6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuXHJcbiAgICAgICAgb25TYXZlKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBzaG93OiBmYWxzZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLmdldEJpbGxzKClcclxuICAgICAgICB9LFxyXG4gICAgfVxyXG5cclxufSlcclxuXHJcbmV4cG9ydCB7IH1cclxuXHJcbiJdfQ==