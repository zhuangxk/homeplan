"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var app = getApp();
var index_1 = require("../../../api/index");
var util_1 = require("../../../utils/util");
Component({
    data: {
        show: false,
        CustomBar: app.globalData.CustomBar,
        bills: [],
        dateMap: {},
        monthMap: {},
        dateMapKeys: [],
        loading: false,
        total: 0,
        params: {
            "page": 1,
            "page_size": -1
        },
        localsNum: ["一", "二", "三", "四", "五", "六", "七", "八", "九", "十", "十一", "十二"],
    },
    properties: {
        ledgerId: {
            type: Number
        }
    },
    lifetimes: {
        ready: function () {
            this.getBills();
        }
    },
    observers: {
        ledgerId: function () {
            this.getBills();
        }
    },
    methods: {
        onClick: function () {
            wx.navigateTo({
                url: '/pages/ledger/bill_detail/bill_detail',
                events: {
                    acceptDataFromOpenedPage: function (data) {
                        console.log(data);
                    },
                    someEvent: function (data) {
                        console.log(data);
                    }
                },
                success: function (res) {
                    res.eventChannel.emit('acceptDataFromOpenerPage', { data: 'test' });
                }
            });
        },
        getBills: function () {
            var _this = this;
            if (!this.data.ledgerId) {
                return;
            }
            if (this.data.loading) {
                return;
            }
            this.data.loading = true;
            wx.showLoading({
                title: '加载中'
            });
            index_1.getBills(this.data.ledgerId, this.data.params).then(function (res) {
                _this.handleBillsRes(res);
                wx.hideLoading();
                _this.data.loading = false;
            });
        },
        handleBillsRes: function (res) {
            var _this = this;
            var list = res.list;
            var dateCount = res.date_count;
            var monthCount = res.month_count;
            var dateMap = {};
            dateCount.forEach(function (item) {
                dateMap[_this.getDateKey(item.date)] = {
                    list: [],
                    total: item.total,
                    sumIn: item.sum_in,
                    sumOut: item.sum_out,
                };
            });
            list.forEach(function (item) {
                var date = dateMap[_this.getDateKey(item.bill_time)];
                if (date.list) {
                    date.list.push(item);
                }
                else {
                    wx.showToast({
                        title: "计数出错"
                    });
                }
            });
            this.setData({
                total: res.total,
                dateMap: dateMap,
                dateMapKeys: Object.keys(dateMap),
                monthMap: monthCount[0],
            });
        },
        getDateKey: function (iosdate) {
            var date = new Date(iosdate);
            var dateKey = util_1.formatMonthDate(date) + "  星期" + this.data.localsNum[date.getDay() - 1];
            if (util_1.formatMonthDate(date) == util_1.formatMonthDate(new Date())) {
                dateKey = "今日  星期" + this.data.localsNum[new Date().getDay() - 1];
            }
            return dateKey;
        },
        onAdd: function () {
            this.setData({
                show: true
            });
        },
        onClose: function () {
            this.setData({
                show: false
            });
        },
        onSave: function () {
            this.setData({
                show: false
            });
            this.getBills();
        },
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlsbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImJpbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLEdBQUcsR0FBRyxNQUFNLEVBQWdCLENBQUE7QUFDbEMsNENBQTZDO0FBQzdDLDRDQUFxRDtBQUNyRCxTQUFTLENBQUM7SUFDTixJQUFJLEVBQUU7UUFDRixJQUFJLEVBQUUsS0FBSztRQUNYLFNBQVMsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLFNBQVM7UUFDbkMsS0FBSyxFQUFFLEVBQWM7UUFDckIsT0FBTyxFQUFFLEVBQStCO1FBQ3hDLFFBQVEsRUFBRSxFQUErQjtRQUN6QyxXQUFXLEVBQUUsRUFBbUI7UUFDaEMsT0FBTyxFQUFFLEtBQUs7UUFDZCxLQUFLLEVBQUUsQ0FBQztRQUNSLE1BQU0sRUFBRTtZQUNKLE1BQU0sRUFBRSxDQUFDO1lBQ1QsV0FBVyxFQUFFLENBQUMsQ0FBQztTQUNsQjtRQUNELFNBQVMsRUFBRSxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxJQUFJLEVBQUMsSUFBSSxDQUFDO0tBQ2pFO0lBQ0QsVUFBVSxFQUFFO1FBQ1IsUUFBUSxFQUFFO1lBQ04sSUFBSSxFQUFFLE1BQU07U0FDZjtLQUNKO0lBQ0QsU0FBUyxFQUFFO1FBQ1AsS0FBSyxFQUFMO1lBQ0UsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBQ2pCLENBQUM7S0FDSjtJQUNELFNBQVMsRUFBRTtRQUNQLFFBQVEsRUFBUjtZQUNJLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNuQixDQUFDO0tBQ0o7SUFDRCxPQUFPLEVBQUU7UUFDTCxPQUFPLEVBQVA7WUFDSSxFQUFFLENBQUMsVUFBVSxDQUFDO2dCQUNWLEdBQUcsRUFBRSx1Q0FBdUM7Z0JBQzVDLE1BQU0sRUFBRTtvQkFFSix3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SSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1lBQzlCLElBQUksT0FBTyxHQUFHLHNCQUFlLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTtZQUNyRixJQUFHLHNCQUFlLENBQUMsSUFBSSxDQUFDLElBQUksc0JBQWUsQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQUM7Z0JBQ3BELE9BQU8sR0FBRyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQTthQUNwRTtZQUNELE9BQU8sT0FBTyxDQUFBO1FBQ2xCLENBQUM7UUFDRCxLQUFLLEVBQUw7WUFDSSxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUNULElBQUksRUFBRSxJQUFJO2FBQ2IsQ0FBQyxDQUFBO1FBQ04sQ0FBQztRQUVELE9BQU8sRUFBUDtZQUNJLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQ1QsSUFBSSxFQUFFLEtBQUs7YUFDZCxDQUFDLENBQUE7UUFDTixDQUFDO1FBRUQsTUFBTSxFQUFOO1lBQ0ksSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFDVCxJQUFJLEVBQUUsS0FBSzthQUNkLENBQUMsQ0FBQTtZQUNGLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNuQixDQUFDO0tBQ0o7Q0FFSixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBhcHAgPSBnZXRBcHAoKSBhcyBJQXBwT3B0aW9uXHJcbmltcG9ydCB7IGdldEJpbGxzIH0gZnJvbSBcIi4uLy4uLy4uL2FwaS9pbmRleFwiXHJcbmltcG9ydCB7IGZvcm1hdE1vbnRoRGF0ZSB9IGZyb20gXCIuLi8uLi8uLi91dGlscy91dGlsXCJcclxuQ29tcG9uZW50KHtcclxuICAgIGRhdGE6IHtcclxuICAgICAgICBzaG93OiBmYWxzZSxcclxuICAgICAgICBDdXN0b21CYXI6IGFwcC5nbG9iYWxEYXRhLkN1c3RvbUJhcixcclxuICAgICAgICBiaWxsczogW10gYXMgQW55QXJyYXksXHJcbiAgICAgICAgZGF0ZU1hcDoge30gYXMgUmVjb3JkPHN0cmluZywgQW55T2JqZWN0PixcclxuICAgICAgICBtb250aE1hcDoge30gYXMgUmVjb3JkPHN0cmluZywgQW55T2JqZWN0PixcclxuICAgICAgICBkYXRlTWFwS2V5czogW10gYXMgQXJyYXk8c3RyaW5nPixcclxuICAgICAgICBsb2FkaW5nOiBmYWxzZSxcclxuICAgICAgICB0b3RhbDogMCxcclxuICAgICAgICBwYXJhbXM6IHtcclxuICAgICAgICAgICAgXCJwYWdlXCI6IDEsXHJcbiAgICAgICAgICAgIFwicGFnZV9zaXplXCI6IC0xXHJcbiAgICAgICAgfSxcclxuICAgICAgICBsb2NhbHNOdW06IFtcIuS4gFwiLFwi5LqMXCIsXCLkuIlcIixcIuWbm1wiLFwi5LqUXCIsXCLlha1cIixcIuS4g1wiLFwi5YWrXCIsXCLkuZ1cIixcIuWNgVwiLFwi5Y2B5LiAXCIsXCLljYHkuoxcIl0sXHJcbiAgICB9LFxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGxlZGdlcklkOiB7IFxyXG4gICAgICAgICAgICB0eXBlOiBOdW1iZXJcclxuICAgICAgICB9ICBcclxuICAgIH0sXHJcbiAgICBsaWZldGltZXM6IHtcclxuICAgICAgICByZWFkeSgpOiB2b2lke1xyXG4gICAgICAgICAgdGhpcy5nZXRCaWxscygpICBcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb2JzZXJ2ZXJzOiB7XHJcbiAgICAgICAgbGVkZ2VySWQoKTogdm9pZCB7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0QmlsbHMoKSBcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgbWV0aG9kczoge1xyXG4gICAgICAgIG9uQ2xpY2soKTogdm9pZHtcclxuICAgICAgICAgICAgd3gubmF2aWdhdGVUbyh7XHJcbiAgICAgICAgICAgICAgICB1cmw6ICcvcGFnZXMvbGVkZ2VyL2JpbGxfZGV0YWlsL2JpbGxfZGV0YWlsJyxcclxuICAgICAgICAgICAgICAgIGV2ZW50czoge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS4uuaMh+WumuS6i+S7tua3u+WKoOS4gOS4quebkeWQrOWZqO+8jOiOt+WPluiiq+aJk+W8gOmhtemdouS8oOmAgeWIsOW9k+WJjemhtemdoueahOaVsOaNrlxyXG4gICAgICAgICAgICAgICAgICAgIGFjY2VwdERhdGFGcm9tT3BlbmVkUGFnZTogZnVuY3Rpb24oZGF0YTogYW55KTogdm9pZCB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKVxyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgc29tZUV2ZW50OiBmdW5jdGlvbihkYXRhOiBhbnkpOiB2b2lkIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDpgJrov4dldmVudENoYW5uZWzlkJHooqvmiZPlvIDpobXpnaLkvKDpgIHmlbDmja5cclxuICAgICAgICAgICAgICAgICAgICByZXMuZXZlbnRDaGFubmVsLmVtaXQoJ2FjY2VwdERhdGFGcm9tT3BlbmVyUGFnZScsIHsgZGF0YTogJ3Rlc3QnIH0pXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIGdldEJpbGxzKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIGlmKCF0aGlzLmRhdGEubGVkZ2VySWQpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodGhpcy5kYXRhLmxvYWRpbmcpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5kYXRhLmxvYWRpbmcgPSB0cnVlXHJcbiAgICAgICAgICAgIHd4LnNob3dMb2FkaW5nKHtcclxuICAgICAgICAgICAgICAgIHRpdGxlOiAn5Yqg6L295LitJ1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICBnZXRCaWxscyh0aGlzLmRhdGEubGVkZ2VySWQsIHRoaXMuZGF0YS5wYXJhbXMpLnRoZW4ocmVzPT57XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZUJpbGxzUmVzKHJlcylcclxuICAgICAgICAgICAgICAgIHd4LmhpZGVMb2FkaW5nKClcclxuICAgICAgICAgICAgICAgIHRoaXMuZGF0YS5sb2FkaW5nID0gZmFsc2VcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhhbmRsZUJpbGxzUmVzKHJlczogQW55T2JqZWN0KTogdm9pZHtcclxuICAgICAgICAgICAgY29uc3QgbGlzdCA9IHJlcy5saXN0IGFzIEFueUFycmF5XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGVDb3VudCA9IHJlcy5kYXRlX2NvdW50IGFzIEFueUFycmF5XHJcbiAgICAgICAgICAgIGNvbnN0IG1vbnRoQ291bnQgPSByZXMubW9udGhfY291bnQgYXMgQW55QXJyYXlcclxuICAgICAgICAgICAgY29uc3QgZGF0ZU1hcCA9IHt9IGFzIFJlY29yZDxzdHJpbmcsIEFueU9iamVjdD5cclxuICAgICAgICAgICAgZGF0ZUNvdW50LmZvckVhY2goaXRlbT0+e1xyXG4gICAgICAgICAgICAgICAgZGF0ZU1hcFt0aGlzLmdldERhdGVLZXkoaXRlbS5kYXRlKV0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGlzdDpbXSxcclxuICAgICAgICAgICAgICAgICAgICB0b3RhbDogaXRlbS50b3RhbCxcclxuICAgICAgICAgICAgICAgICAgICBzdW1JbjogaXRlbS5zdW1faW4sXHJcbiAgICAgICAgICAgICAgICAgICAgc3VtT3V0OiBpdGVtLnN1bV9vdXQsXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsaXN0LmZvckVhY2goIGl0ZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZGF0ZSA9IGRhdGVNYXBbdGhpcy5nZXREYXRlS2V5KGl0ZW0uYmlsbF90aW1lKV1cclxuICAgICAgICAgICAgICAgIGlmKGRhdGUubGlzdCl7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0ZS5saXN0LnB1c2goaXRlbSlcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IFwi6K6h5pWw5Ye66ZSZXCJcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgdG90YWw6IHJlcy50b3RhbCxcclxuICAgICAgICAgICAgICAgIGRhdGVNYXAsXHJcbiAgICAgICAgICAgICAgICBkYXRlTWFwS2V5czogT2JqZWN0LmtleXMoZGF0ZU1hcCksXHJcbiAgICAgICAgICAgICAgICBtb250aE1hcDogbW9udGhDb3VudFswXSxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ2V0RGF0ZUtleShpb3NkYXRlOiBzdHJpbmcpOiBzdHJpbmd7XHJcbiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShpb3NkYXRlKVxyXG4gICAgICAgICAgICBsZXQgZGF0ZUtleSA9IGZvcm1hdE1vbnRoRGF0ZShkYXRlKSArIFwiICDmmJ/mnJ9cIiArIHRoaXMuZGF0YS5sb2NhbHNOdW1bZGF0ZS5nZXREYXkoKSAtIDFdXHJcbiAgICAgICAgICAgIGlmKGZvcm1hdE1vbnRoRGF0ZShkYXRlKSA9PSBmb3JtYXRNb250aERhdGUobmV3IERhdGUoKSkpe1xyXG4gICAgICAgICAgICAgICAgZGF0ZUtleSA9IFwi5LuK5pelICDmmJ/mnJ9cIiArIHRoaXMuZGF0YS5sb2NhbHNOdW1bbmV3IERhdGUoKS5nZXREYXkoKSAtIDFdXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGRhdGVLZXlcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9uQWRkKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBzaG93OiB0cnVlXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSxcclxuICBcclxuICAgICAgICBvbkNsb3NlKCk6IHZvaWR7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0RGF0YSh7XHJcbiAgICAgICAgICAgICAgICBzaG93OiBmYWxzZVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIG9uU2F2ZSgpOiB2b2lke1xyXG4gICAgICAgICAgICB0aGlzLnNldERhdGEoe1xyXG4gICAgICAgICAgICAgICAgc2hvdzogZmFsc2VcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgdGhpcy5nZXRCaWxscygpXHJcbiAgICAgICAgfSxcclxuICAgIH1cclxuXHJcbn0pXHJcblxyXG5leHBvcnQgeyB9XHJcblxyXG4iXX0=